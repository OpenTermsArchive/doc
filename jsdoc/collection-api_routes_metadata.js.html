<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: collection-api/routes/metadata.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: collection-api/routes/metadata.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import fs from 'fs/promises';
import path from 'path';

import express from 'express';
import yaml from 'js-yaml';

import Service from '../../archivist/services/service.js';

const METADATA_FILENAME = 'metadata.yml';
const PACKAGE_JSON_PATH = '../../../package.json';

/**
 * @swagger
 * tags:
 *   name: Metadata
 *   description: Collection metadata API
 * components:
 *   schemas:
 *     Metadata:
 *       type: object
 *       description: Collection metadata
 *       additionalProperties: false
 *       properties:
 *         id:
 *           type: string
 *           description: Unique identifier of the collection
 *         name:
 *           type: string
 *           description: Display name of the collection
 *         tagline:
 *           type: string
 *           description: Short description of the collection
 *         description:
 *           type: string
 *           nullable: true
 *           description: Detailed description of the collection
 *         totalTerms:
 *           type: integer
 *           description: Total number of terms tracked in the collection
 *         totalServices:
 *           type: integer
 *           description: Total number of services tracked in the collection
 *         engineVersion:
 *           type: string
 *           description: Version of the Open Terms Archive engine in SemVer format (MAJOR.MINOR.PATCH)
 *         dataset:
 *           type: string
 *           format: uri
 *           description: URL to the dataset releases
 *         declarations:
 *           type: string
 *           format: uri
 *           description: URL to the declarations repository
 *         versions:
 *           type: string
 *           format: uri
 *           description: URL to the versions repository
 *         snapshots:
 *           type: string
 *           format: uri
 *           description: URL to the snapshots repository
 *         donations:
 *           type: string
 *           format: uri
 *           description: URL to the donations page
 *         logo:
 *           type: string
 *           format: uri
 *           nullable: true
 *           description: URL to the collection logo
 *         languages:
 *           type: array
 *           description: List of ISO 639-1 (two-letter) language codes representing languages allowed by the collection
 *           items:
 *             type: string
 *             format: iso639-1
 *         jurisdictions:
 *           type: array
 *           description: List of ISO 3166-2 country codes representing jurisdictions covered by the collection
 *           items:
 *             type: string
 *             format: iso3166-2
 *         trackingPeriods:
 *           type: array
 *           items:
 *             type: object
 *             additionalProperties: false
 *             properties:
 *               startDate:
 *                 type: string
 *                 format: date
 *                 description: The date when tracking started for this period
 *               schedule:
 *                 type: string
 *                 format: cron-expression
 *                 description: A cron expression defining when terms are tracked (e.g. "0 0 * * *" for daily at midnight)
 *               serverLocation:
 *                 type: string
 *                 description: The geographic location of the server used for tracking
 *               endDate:
 *                 type: string
 *                 format: date
 *                 description: The date when tracking ended for this period
 *         governance:
 *           type: object
 *           additionalProperties:
 *             type: object
 *             additionalProperties: false
 *             properties:
 *               url:
 *                 type: string
 *                 format: uri
 *                 description: URL to the entity's website
 *               logo:
 *                 type: string
 *                 format: uri
 *                 description: URL to the entity's logo
 *               roles:
 *                 type: array
 *                 items:
 *                   type: string
 *                   enum: [host, administrator, curator, maintainer, sponsor]
 *                   description: Roles of the entity within the governance
 *         i18n:
 *           type: object
 *           description: Internationalization of any of the Metadata properties (except i18n itself) for different language codes
 *           additionalProperties:
 *             type: object
 */
export default async function metadataRouter(collectionPath, services) {
  const router = express.Router();

  const STATIC_METADATA = yaml.load(await fs.readFile(path.join(collectionPath, METADATA_FILENAME), 'utf8'));
  const { version: engineVersion } = JSON.parse(await fs.readFile(new URL(PACKAGE_JSON_PATH, import.meta.url)));

  /**
   * @swagger
   * /metadata:
   *   get:
   *     summary: Get collection metadata
   *     tags: [Metadata]
   *     produces:
   *       - application/json
   *     responses:
   *       200:
   *         description: Collection metadata
   */
  router.get('/metadata', (req, res) => {
    const dynamicMetadata = {
      totalServices: Object.keys(services).length,
      totalTerms: Service.getNumberOfTerms(services),
      engineVersion,
    };

    res.json({
      ...STATIC_METADATA,
      ...dynamicMetadata,
    });
  });

  return router;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Record.html">Record</a></li></ul><h3>Global</h3><ul><li><a href="global.html#extract">extract</a></li><li><a href="global.html#fetch">fetch</a></li><li><a href="global.html#normalizeConfig">normalizeConfig</a></li><li><a href="global.html#router">router</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Tue Feb 18 2025 11:06:37 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
